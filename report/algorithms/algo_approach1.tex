\begin{algorithm}[t]
    \caption{Parallel Nested Loop algorithm: approach 1}\label{algo:pbj}
    \begin{algorithmic}[1]
        \Require \textit{left} : triple pattern; \textit{right} : triple pattern; \textit{sources} : set of Endpoint; \textit{bucketSize} : entier
        \Ensure \textit{results} : set of Bindings
        \Function{ParallelNestedLoop}{\textit{left},\textit{sources}, \textit{bucketSize}}
            \State \textit{results} $\gets$ empty set of Bindings
            \State \textit{buckets} $\gets$ empty set of set of Bindings
            \State \textit{currentBucket} $\gets$ empty set of Bindings
            
            \For{\textit{bindings} \textbf{in} \Call{ReceiveBindings}{\textit{left}}}\Comment{Create buckets from the outer loop}
                \If{\Call{Size}{\textit{currentBucket}} $>$ \textit{bucketSize}}
                    \State \textit{buckets} $\gets \textit{buckets} \cup \{ \textit{currentBucket} \}$
                    \State \textit{currentBucket} $\gets$ empty set of Bindings
                \EndIf
                \State \textit{currentBucket} $\gets \textit{currentBucket} \cup \{ \textit{bindings} \}$
            \EndFor
            
            \State \textit{groups} $\gets$ \Call{Partition}{\textit{sources}, \textit{buckets}}\Comment{Perform partition using \textit{Best Fit Decreasing}}
            
            \For{\textit{endpoint}, \textit{subset} \textbf{in} \textit{groups} \textsc{in parallel}}
                % add something to indicate that this is launched in parallel
                \State \textit{data} $\gets$ \Call{SendBindings}{right, \textit{endpoint}, \textit{subset}}\Comment{Get new bindings in parallel}
                \State \textit{results} $\gets$ \textit{results} $\cup$ \textit{data}
            \EndFor
            
            \State \textsc{wait for all processes to finish}
            \State \textbf{return} \textit{results}
        \EndFunction
    \end{algorithmic}
\end{algorithm}
